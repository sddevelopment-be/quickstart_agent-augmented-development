# Framework Installation Guide

## Overview

This guide explains how to install the agent-augmented development framework into a downstream repository using the `framework_install.sh` script.

## Prerequisites

- POSIX-compliant shell (sh, bash, dash, or ash)
- Framework distribution package (ZIP file from release)
- Target repository where you want to install the framework

## Installation Process

### Step 1: Download and Extract Framework

Download the latest framework release ZIP file:

```bash
# Example: Download from GitHub Releases
wget https://github.com/sddevelopment-be/quickstart_agent-augmented-development/releases/download/v1.0.0/quickstart-framework-1.0.0.zip

# Extract the archive
unzip quickstart-framework-1.0.0.zip
cd quickstart-framework-1.0.0/
```

The extracted package contains:
- `framework_core/` - Core framework files (agents, templates, guidelines, etc.)
- `scripts/framework_install.sh` - Installation script
- `scripts/framework_upgrade.sh` - Upgrade script (for future updates)
- `META/MANIFEST.yml` - File inventory and version information

### Step 2: Run the Installation Script

Navigate to your target repository and run the installation:

```bash
# From within the framework distribution directory
./scripts/framework_install.sh /path/to/your/project

# Or with an absolute path
/path/to/framework/scripts/framework_install.sh /path/to/your/project
```

### Step 3: Verify Installation

Check that the framework was installed successfully:

```bash
cd /path/to/your/project

# Verify metadata file was created
cat .framework_meta.yml

# Check that framework files were copied
ls -la .github/agents/
ls -la docs/templates/
ls -la validation/
```

## Usage Examples

### Basic Installation

Install the framework into a project in your home directory:

```bash
cd ~/downloads/quickstart-framework-1.0.0
./scripts/framework_install.sh ~/projects/my-app
```

### Dry-Run Mode

Preview what the installation would do without making changes:

```bash
./scripts/framework_install.sh --dry-run /path/to/project
```

Output example:
```
=== DRY RUN MODE ===
Actions will be reported but not executed

Framework Installation Script
Version: 1.0.0

Scanning framework_core for files to install...
[DRY RUN] Would copy: .github/agents/AGENTS.md
[DRY RUN] Would copy: .github/agents/profiles/architect.agent.md
[DRY RUN] Would copy: docs/templates/agent-tasks/task-template.yml
...
[DRY RUN] Would create .framework_meta.yml

=== Installation Summary ===
MODE: DRY RUN (no changes made)
NEW: 45 files
SKIPPED: 0 files
Framework version: 1.0.0
Target: /path/to/project
```

### Installation with Existing Files

The script will **never overwrite existing files**. If files already exist in your project, they will be skipped:

```bash
./scripts/framework_install.sh /path/to/existing-project
```

Output:
```
Scanning framework_core for files to install...
NEW: .github/agents/AGENTS.md
SKIP: docs/VISION.md (already exists)
SKIP: README.md (already exists)
NEW: validation/validate-work-structure.sh
...

=== Installation Summary ===
NEW: 38 files
SKIPPED: 7 files
Framework version: 1.0.0
Target: /path/to/existing-project
Installation complete at 2025-12-21T10:30:00Z
```

## Understanding Installation Metadata

After installation, a `.framework_meta.yml` file is created in your project root:

```yaml
# Framework Installation Metadata
# Generated by framework_install.sh
# DO NOT EDIT MANUALLY - managed by framework tools

framework_version: "1.0.0"
installed_at: "2025-12-21T10:30:00Z"
source_release: "quickstart-framework-1.0.0"

# Installation summary
files_installed: 45
files_skipped: 0
```

This metadata file:
- Tracks which version is installed
- Records the installation timestamp
- Is used by upgrade scripts to detect existing installations
- Should not be edited manually

## Exit Codes

The `framework_install.sh` script uses the following exit codes:

| Code | Meaning |
|------|---------|
| 0 | Success - framework installed successfully |
| 1 | Framework already installed (`.framework_meta.yml` exists) |
| 2 | Invalid parameters (missing PROJECT_ROOT or unknown options) |
| 3 | `framework_core/` directory not found |
| 4 | `META/MANIFEST.yml` not found |
| 5 | Failed to create directories |
| 6 | Failed to copy files |
| 7 | Failed to create metadata file |

These exit codes can be used in automation scripts:

```bash
#!/bin/sh
if ./scripts/framework_install.sh /path/to/project; then
    echo "Installation successful"
else
    exit_code=$?
    case $exit_code in
        1) echo "Framework already installed - use upgrade script instead" ;;
        2) echo "Invalid parameters provided" ;;
        *) echo "Installation failed with exit code $exit_code" ;;
    esac
    exit $exit_code
fi
```

## Environment Variables

You can customize the installation behavior using environment variables:

### FRAMEWORK_SOURCE

Override the default `framework_core/` location:

```bash
FRAMEWORK_SOURCE=/custom/path/framework_core \
  ./scripts/framework_install.sh /path/to/project
```

### MANIFEST_PATH

Override the default `META/MANIFEST.yml` location:

```bash
MANIFEST_PATH=/custom/META/MANIFEST.yml \
  ./scripts/framework_install.sh /path/to/project
```

### SOURCE_RELEASE

Specify a custom source release name (appears in `.framework_meta.yml`):

```bash
SOURCE_RELEASE="custom-framework-v2.0" \
  ./scripts/framework_install.sh /path/to/project
```

## Troubleshooting

### Error: "Framework already installed"

**Cause:** The target directory already has a `.framework_meta.yml` file.

**Solution:** If you want to upgrade an existing installation, use `framework_upgrade.sh` instead:

```bash
./scripts/framework_upgrade.sh /path/to/project
```

If you want to force a fresh installation, manually remove the metadata file first:

```bash
rm /path/to/project/.framework_meta.yml
./scripts/framework_install.sh /path/to/project
```

### Error: "framework_core/ directory not found"

**Cause:** The script cannot find the `framework_core/` directory.

**Solution:** Ensure you're running the script from the extracted framework distribution directory, or use the `FRAMEWORK_SOURCE` environment variable to specify the correct location.

### Error: "Failed to create directories"

**Cause:** Insufficient permissions or disk space.

**Solution:** 
1. Check that you have write permissions to the target directory
2. Verify sufficient disk space is available
3. Check parent directory permissions

### Files with Spaces in Names

The script correctly handles filenames with spaces, special characters, and Unicode:

```bash
# These will all work correctly
framework_core/docs/My Document.md
framework_core/files/special (chars).txt
framework_core/unicode/文档.md
```

### Installation on Windows

On Windows, use Windows Subsystem for Linux (WSL):

```bash
# In WSL terminal
cd /mnt/c/Downloads/quickstart-framework-1.0.0
./scripts/framework_install.sh /mnt/c/Projects/my-app
```

## What Gets Installed

The framework installation includes:

### Core Agent Files
- `.github/agents/` - Agent profiles, framework specifications, and guardrails
- `docs/templates/agent-tasks/` - Task templates for file-based collaboration

### Documentation & Guidelines
- `docs/directives/` - Operational directives and specifications
- `docs/guidelines/` - Best practices and approaches
- `docs/templates/` - Various templates (architecture, prompts, etc.)

### Validation & Tooling
- `validation/` - Schema validation, portability tests, audit protocols
- `work/` - Scaffolding for file-based orchestration

### Work Structure
- `work/collaboration/` - Inbox, assigned, done directories for task coordination
- `work/reports/` - Location for agent work logs and status reports

## Next Steps

After installation:

1. **Review the framework documentation:**
   ```bash
   cat .github/agents/AGENTS.md
   cat docs/WORKFLOWS.md
   ```

2. **Customize your setup:**
   - Create local agent profiles in `local/agents/`
   - Add project-specific guidelines in `local/guidelines/`
   - Configure your project vision in `docs/VISION.md`

3. **Run validation:**
   ```bash
   ./validation/validate-work-structure.sh
   ```

4. **Set up Git tracking:**
   ```bash
   git add .
   git commit -m "Install agent-augmented development framework v1.0.0"
   ```

5. **Future upgrades:**
   When a new framework version is released, use:
   ```bash
   ./scripts/framework_upgrade.sh /path/to/project
   ```

## Related Documentation

- **ADR-013:** Zip-Based Framework Distribution
- **ADR-014:** Framework Guardian Agent  
- **Technical Design:** `docs/architecture/design/distribution_of_releases_technical_design.md`
- **Upgrade Guide:** `docs/HOW_TO_USE/framework-upgrade.md` (for future updates)

## Support

For issues or questions:

1. Check this guide's troubleshooting section
2. Review the framework's GitHub issues
3. Consult the architecture decision records (ADRs)
4. Run in dry-run mode to diagnose issues: `--dry-run`

## Script Reference

**Location:** `ops/scripts/framework_install.sh`  
**Test Suite:** `ops/scripts/tests/test_framework_install.sh`  
**Version:** 1.0.0  
**POSIX Compliant:** Yes (tested with sh, bash, dash, ash)  
**Platforms:** Linux, macOS, WSL (Windows Subsystem for Linux)
