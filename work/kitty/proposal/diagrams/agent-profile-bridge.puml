@startuml agent_profile_bridge
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

skinparam backgroundColor #FEFEFE
skinparam defaultFontName "Verdana"
skinparam defaultFontSize 13
skinparam wrapWidth 240

LAYOUT_LEFT_RIGHT()

title Agent Profile Bridge — SK Config ↔ Doctrine Enrichment → Routing Decision

!define SK_COLOR #FFF3E0
!define AAD_COLOR #E3F2FD
!define ROUTE_COLOR #F3E5F5
!define OUTPUT_COLOR #E8F5E9

' === Left: Spec Kitty ===

rectangle "**Spec Kitty**\nExecution Mechanics" as sk SK_COLOR {
  rectangle "Agent Config Key\n\"claude-sonnet\" · \"gpt-4o\"" as agentkey SK_COLOR
  rectangle "Tool Binding · Worktree Isolation\nMission Context" as sk_exec SK_COLOR
}

' === Center: Doctrine enrichment ===

rectangle "**Agentic Doctrine**\nRole Intelligence" as aad AAD_COLOR {
  rectangle "AgentProfile Lookup\ndoctrine/agents/*.agent.md" as lookup AAD_COLOR
  rectangle "Role · Capabilities · Handoffs\nDirectives · Reasoning Modes" as identity AAD_COLOR
}

' === Right: Unified routing ===

rectangle "**RoutingProvider**\n(Layer 4)" as router ROUTE_COLOR {
  rectangle "route_task(task_context)\n→ RoutingDecision" as routefn ROUTE_COLOR
}

rectangle "**RoutingDecision**" as decision OUTPUT_COLOR {
  rectangle "Agent Key + Model · Role + Tool\nFallback chain · Directives · Workspace" as output OUTPUT_COLOR
}

' === Flow ===

agentkey -right-> lookup : config key\nlookup
lookup -down-> identity : enrich

sk_exec -right-> routefn : execution\ncontext
identity -right-> routefn : role\nintelligence
routefn -right-> output : unified\ndecision

note bottom of decision
  **RoutingDecision contains:**
  • Agent key + model (from SK)
  • Role identity + directives (from Doctrine)
  • Fallback chain (ordered alternatives)
  • Workspace assignment
end note

note top of lookup
  **Bridge pattern:** SK flat config keys
  get enriched through Doctrine agent
  profiles to produce rich identity
  that informs routing decisions.
end note

legend right
  |= Side |= Provides |= Examples |
  | <back:#FFF3E0>  Spec Kitty  </back> | Execution mechanics | Tool binding, worktree, mission |
  | <back:#E3F2FD>  Doctrine  </back> | Role intelligence | Capabilities, handoffs, reasoning modes |
  | <back:#F3E5F5>  RoutingProvider  </back> | Unification | Task → agent + model + tool |
  | <back:#E8F5E9>  Decision  </back> | Output contract | Complete routing with fallbacks |
endlegend

@enduml
