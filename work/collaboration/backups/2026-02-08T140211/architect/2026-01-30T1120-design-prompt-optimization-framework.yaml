id: 2026-01-30T1120-design-prompt-optimization-framework
agent: architect-alphonso
status: assigned
priority: high
title: Design Prompt Optimization Framework Architecture
artefacts:
  - docs/architecture/adrs/ADR-XXX-prompt-optimization-framework.md
estimated_duration: 6-8 hours
created_at: '2026-01-30T11:20:00Z'
assigned_by: github-copilot

context_files:
  - work/reports/assessments/work-log-analysis-suboptimal-patterns.md
  - work/reports/exec_summaries/prompt-optimization-executive-summary.md
  - docs/HOW_TO_USE/prompt-optimization-quick-reference.md
  - work/reports/assessments/export-module-implementation-review.md

related_adrs:
  - ADR-017 (Traceable Decisions)
  - ADR-013 (Multi-Format Distribution Strategy)

directives:
  - 016 (ATDD)
  - 017 (TDD)
  - 018 (Traceable Decisions)

description: |
  # Task: Design Prompt Optimization Framework Architecture
  
  ## Objective
  
  Review the efficiency analysis findings from the work log analysis and design a comprehensive architectural solution to remediate the 12 identified suboptimal prompt patterns, with focus on systemic improvements that benefit the entire agent framework.
  
  ## Context
  
  ### Current Situation
  
  Researcher Ralph's analysis of 129 work logs identified 12 suboptimal prompt patterns that impact efficiency:
  
  1. **Vague success criteria** - 30% of tasks lack clear success criteria
  2. **Missing deliverable lists** - Unclear what artifacts agents should produce
  3. **Ambiguous priorities** - Tasks lack clear prioritization guidance
  4. **Scope creep enabling language** - Prompts do not bound task scope effectively
  5. **Missing directive file paths** - Agents must search for directive documents
  6. **Incomplete context loading** - 23K-64K input tokens loaded without progressive disclosure
  7. **Implicit follow-up expectations** - Handoff patterns not explicit
  8. **No checkpoint guidance** - Long tasks lack intermediate validation points
  9. **Undefined quality thresholds** - No clear pass/fail criteria
  10. **Redundant compliance reminders** - Same directives repeated across prompts
  11. **Missing constraint guidance** - Resource limits (time, tokens) not specified
  12. **Overloaded prompts** - Single prompts trying to do too much
  
  ### Framework Health
  - **Current Score:** 92/100 (Production-Ready)
  - **Potential Score:** 97-98/100 (with optimizations)
  - **Expected Efficiency Gain:** 30-40% (7-15 min per task)
  - **Annual ROI:** 140-300 hours saved
  - **Token Savings:** 30% reduction (360K-480K tokens/month)
  
  ### Quick Wins Identified
  1. Standardize prompt templates (2-4 hrs) → 30-40% fewer clarifications
  2. Automate token counting (4-6 hrs) → 100% consistent metrics
  3. Cross-reference validation (2-3 hrs) → Zero broken links

requirements: |
  ## Requirements
  
  ### Primary Deliverable: Architectural Design Document (ADR)
  
  Create a **Proposed ADR** that addresses the prompt optimization challenge with:
  
  #### 1. Problem Statement
  - Synthesize the 12 patterns into core architectural concerns
  - Quantify impact (efficiency, cost, quality)
  - Identify root causes (tooling gaps, process gaps, template gaps)
  
  #### 2. Architecture Options
  
  Evaluate at least **3 alternative approaches**:
  
  **Option A: Prompt Template Standardization**
  - Create canonical prompt templates with mandatory sections
  - Enforce via validation in CI/CD
  - Pros/Cons analysis
  
  **Option B: Metadata-Driven Prompt Generation**
  - Define prompt schema (JSON/YAML)
  - Generate prompts programmatically from metadata
  - Pros/Cons analysis
  
  **Option C: Agent Framework Enhancement**
  - Extend parser to extract/validate prompt structure
  - Add runtime validation in agent bootstrap
  - Pros/Cons analysis
  
  **Option D: Hybrid Approach**
  - Combination of above options
  - Staged rollout strategy
  
  #### 3. Recommended Solution
  
  Your preferred approach with detailed rationale covering:
  - Why it best addresses the 12 patterns
  - How it aligns with existing architecture (export pipeline, directives, etc.)
  - Migration path from current state
  - Risk mitigation strategies
  
  #### 4. Technical Design
  
  For the recommended solution, provide:
  
  **Component Architecture:**
  - What new modules/tools are needed?
  - What existing modules need modification?
  - How do components interact?
  - What data flows between them?
  
  **Schema/Format Design:**
  - If introducing new formats, specify schemas
  - Show examples of before/after
  - Validate against existing agent profiles
  
  **Integration Points:**
  - How does it integrate with export pipeline?
  - How does it relate to Directive 014 (work log requirements)?
  - How does it leverage the parser/validator modules?
  
  **Implementation Phases:**
  - Phase 1: Core infrastructure (estimated effort)
  - Phase 2: Template migration (estimated effort)
  - Phase 3: Validation enforcement (estimated effort)
  - Phase 4: Monitoring and optimization (estimated effort)
  
  #### 5. Success Metrics
  
  Define measurable outcomes:
  - **Primary:** Reduction in clarification requests (target: 30-40%)
  - **Primary:** Token usage reduction (target: 30%)
  - **Secondary:** Consistent work log quality (target: 100% Directive 014 compliance)
  - **Secondary:** Faster task completion (target: 20% reduction)
  - **Quality:** Maintain framework health score >95/100
  
  #### 6. Risk Assessment
  
  Identify and mitigate risks:
  - **Migration complexity** - How to update 7 prompts + 12 approaches + 15 agents?
  - **Breaking changes** - How to ensure backward compatibility?
  - **Learning curve** - How to onboard agents to new patterns?
  - **Maintenance burden** - Is the solution sustainable long-term?
  
  #### 7. Cross-References
  
  Link to related architecture:
  - Export pipeline (ADR-013, tech-design-export-pipeline.md)
  - Work log requirements (Directive 014)
  - Traceable decisions (ADR-017, Directive 018)
  - Test-first development (Directives 016, 017)

constraints:
  must_honor:
    - Directive 016 (ATDD): Design must be testable with clear acceptance criteria
    - Directive 017 (TDD): Implementation must support unit testing
    - Directive 018 (Traceable Decisions): Design decisions must link to evidence
    - Locality of Change: Minimize disruption to existing working code
    - Source of Truth Preservation: Markdown files remain authoritative
  must_consider:
    - Export Module Architecture: Solution should leverage or enhance existing parser/validator
    - CI/CD Integration: Validation should be automatable
    - Multi-Agent Impact: Solution affects 15 agents + 7 prompts + 12 approaches
    - Token Budget: Solution itself should not add significant overhead

deliverables:
  primary:
    - file: docs/architecture/adrs/ADR-XXX-prompt-optimization-framework.md
      status: Proposed
      description: Full architectural design, trade-off analysis, implementation roadmap
  supporting:
    - Component Diagram: Visualize the architecture
    - Migration Plan: Step-by-step guide for adopting new patterns
    - Schema Examples: If proposing new formats/schemas

references:
  analysis_documents:
    - work/reports/assessments/work-log-analysis-suboptimal-patterns.md
    - work/reports/exec_summaries/prompt-optimization-executive-summary.md
    - docs/HOW_TO_USE/prompt-optimization-quick-reference.md
    - work/reports/assessments/export-module-implementation-review.md
  existing_architecture:
    - work/analysis/tech-design-export-pipeline.md
    - ops/exporters/parser.js
    - ops/exporters/validator.js

assigned_to: Architect Alphonso
