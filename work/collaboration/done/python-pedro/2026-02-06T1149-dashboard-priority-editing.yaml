---
id: 2026-02-06T1149-dashboard-priority-editing
title: Dashboard Task Priority Editing (ADR-035)
agent: python-pedro
status: done
priority: high
created: '2026-02-06T11:49:00Z'
estimated_hours: 8
specification: specifications/initiatives/dashboard-enhancements/task-priority-editing.md
description: 'Implement in-place priority editing in the dashboard with in-progress
  task protection.


  ## Scope

  ### Backend (5 hours)

  - Create PATCH /api/tasks/:id/priority endpoint

  - Implement YAML file writer with comment preservation (ruamel.yaml)

  - Add priority validation (CRITICAL, HIGH, MEDIUM, LOW, normal)

  - Add status validation (reject if status: in_progress)

  - Implement atomic file writes (temp file → rename)

  - Add optimistic locking with last_modified timestamp

  - Unit tests for YAML operations and validation


  ### Frontend (3 hours)

  - Replace static priority badge with dropdown component

  - Wire to PATCH endpoint

  - Handle loading/success/error states

  - Add in-progress indicator (pulsing dot + "In Progress" badge)

  - Disable dropdown for in-progress and done tasks

  - WebSocket event handling for real-time updates

  '
context:
  phase: Phase 2 of dashboard enhancements initiative
  parallelizable: Can be developed in parallel with Phase 1 (Markdown Rendering)
  related_adrs:
  - 'ADR-035: Dashboard Task Priority Editing (primary)'
  - 'ADR-032: Real-Time Execution Dashboard (foundation)'
  technical_design: docs/architecture/design/dashboard-enhancements-technical-design.md
  implementation_order: 2nd of 3 features (Markdown → Priority → Portfolio)
acceptance_criteria: '**Backend:**

  - [ ] PATCH /api/tasks/:id/priority endpoint implemented

  - [ ] ruamel.yaml library integrated for comment preservation

  - [ ] Priority validation: only allow valid enum values

  - [ ] Status validation: return 409 if status == "in_progress"

  - [ ] Atomic file writes implemented (no corruption on failure)

  - [ ] Optimistic locking: check last_modified timestamp

  - [ ] Unit tests: 80%+ coverage for priority operations

  - [ ] Error handling: 400 (invalid priority), 404 (not found), 409 (conflict)


  **Frontend:**

  - [ ] Priority dropdown component replaces static badge

  - [ ] Dropdown disabled for in_progress and done tasks

  - [ ] In-progress indicator: pulsing dot animation + badge

  - [ ] Loading spinner shows during save

  - [ ] Success/error toasts for user feedback

  - [ ] WebSocket updates priority display on all clients

  - [ ] Performance: <500ms P95 for priority save


  **Integration:**

  - [ ] End-to-end test: Select priority → YAML updated → WebSocket received

  - [ ] Concurrent edit scenario tested (optimistic locking works)

  - [ ] Multi-browser real-time sync tested

  '
implementation_notes: "**Phase 1: Backend API (2-3 hours)**\n```python\n@app.route('/api/tasks/<task_id>/priority',\
  \ methods=['PATCH'])\ndef update_priority(task_id):\n    data = request.json\n \
  \   priority = data['priority']\n    last_modified = data.get('last_modified')\n\
  \    \n    # Validate priority enum\n    if priority not in ['CRITICAL', 'HIGH',\
  \ 'MEDIUM', 'LOW', 'normal']:\n        return jsonify({'error': 'Invalid priority'}),\
  \ 400\n    \n    # Load task, check status\n    task = load_task(task_id)\n    if\
  \ task['status'] == 'in_progress':\n        return jsonify({'error': 'Cannot edit\
  \ in-progress task'}), 409\n    \n    # Optimistic locking check\n    if last_modified\
  \ and task['updated'] != last_modified:\n        return jsonify({'error': 'Concurrent\
  \ modification'}), 409\n    \n    # Atomic write with ruamel.yaml\n    update_task_priority(task_id,\
  \ priority)\n    \n    return jsonify({'success': True, 'task': task})\n```\n\n\
  **Phase 2: Frontend Dropdown (2-3 hours)**\n- Create PriorityDropdown Vue/React\
  \ component (or vanilla JS)\n- Wire to API endpoint\n- Handle states: enabled, disabled,\
  \ loading, error\n\n**Phase 3: In-Progress Indicator (2 hours)**\n- CSS pulsing\
  \ animation for active tasks\n- Conditional rendering based on task.status\n\n**Phase\
  \ 4: Testing (1 hour)**\n- E2E: Priority change flow\n- Security: Path traversal,\
  \ YAML injection attempts\n- Concurrent edit scenario\n"
dependencies: []
blocked_by: []
blocks:
- 2026-02-06T1150-dashboard-initiative-tracking
artefacts:
- src/llm_service/dashboard/app.py
- src/llm_service/dashboard/task_updater.py
- src/llm_service/dashboard/static/js/dashboard.js
- src/llm_service/dashboard/static/css/dashboard.css
tags:
- dashboard
- backend
- frontend
- yaml
- adr-035
- m4-batch-4.3
notes: '**Security Considerations:**

  - Validate priority against whitelist (prevent YAML injection)

  - Sanitize task_id to prevent path traversal

  - Use ruamel.yaml.safe_load() to prevent code execution


  **Performance Targets:**

  - YAML parse + write + file sync: <200ms

  - WebSocket broadcast: <100ms

  - End-to-end latency: <500ms P95


  **Concurrency:**

  - Optimistic locking prevents most conflicts

  - In rare race conditions, last write wins (acceptable for priority)

  - File watcher detects change and broadcasts update

  '
result:
  summary: Priority editing implemented with backend API, YAML preservation, and real-time
    frontend updates
  artifacts:
  - src/llm_service/dashboard/app.py
  - src/llm_service/dashboard/task_updater.py
  - src/llm_service/dashboard/static/js/dashboard.js
  - src/llm_service/dashboard/static/css/dashboard.css
  completed_at: '2026-02-06T20:00:00Z'
