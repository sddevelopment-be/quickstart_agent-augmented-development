# Task: Review src/ for Duplicate Concept Representations
#
# Created: 2026-02-08T03:28:00Z
# Status: new
# Priority: medium
# Type: analysis

task_id: "2026-02-08T0328-review-src-duplicates"
created_at: "2026-02-08T03:28:00Z"
status: "new"
priority: "medium"

# Target agent - either backend specialist
agent: "python-pedro"
alternate_agents: ["backend-benny"]

# Task metadata
metadata:
  type: "code-analysis"
  category: "refactoring-preparation"
  estimated_duration: "3-4 hours"
  complexity: "medium"

# Objective
objective: |
  Analyze the src/ directory (llm_service + framework) to identify duplicate or 
  inconsistent representations of the same concepts. Ensure shared abstractions 
  (Task, Agent, TaskStatus, etc.) are used consistently throughout both modules.
  
  Goal: Create an inventory of concept duplication and propose consolidation strategy
  to ensure single source of truth for each abstraction.

# Context
context:
  background: |
    During doctrine refactoring analysis, we identified that src/ contains two modules:
    - src/llm_service/ (LLM routing service)
    - framework/ (to be moved to src/framework/)
    
    Additionally, ops/orchestration/ will move to src/framework/orchestration/
    
    Question: Are Task/Agent/Status concepts represented consistently across these?
    Do we have duplicate implementations that should be unified?
  
  related_work:
    - "work/reports/analysis/2026-02-08-code-refactoring-proposal.md"
    - "work/reports/analysis/2026-02-07-code-directory-consolidation-analysis.md"
  
  key_files:
    - "framework/core.py - Task, Agent, TaskStatus abstractions"
    - "framework/execution/ - Model routing"
    - "ops/orchestration/agent_orchestrator.py - Orchestration runtime"
    - "src/llm_service/ - LLM routing implementation"
  
  constraints:
    - "This is analysis only - no code changes"
    - "Focus on conceptual duplication, not implementation details"
    - "Inventory should be actionable for future refactoring"

# Deliverables
deliverables:
  - file: "work/reports/analysis/2026-02-08-src-concept-duplication-inventory.md"
    description: "Comprehensive inventory of duplicate/inconsistent concepts"
    validation: "Document includes: concept map, duplication analysis, consolidation recommendations"
  
  - file: "work/reports/analysis/2026-02-08-src-abstraction-dependencies.md"
    description: "Dependency graph showing how modules use shared abstractions"
    validation: "Shows import relationships and identifies circular dependencies"

# Success criteria
success_criteria:
  - "All major abstractions (Task, Agent, Status, Config, etc.) cataloged"
  - "Duplicate implementations identified with file references"
  - "Inconsistent usage patterns documented"
  - "Consolidation strategy proposed with effort estimate"
  - "Dependencies mapped to identify refactoring order"

# Analysis approach
approach:
  steps:
    - "Survey framework/core.py for core abstractions"
    - "Survey src/llm_service/ for Task/Agent usage"
    - "Survey ops/orchestration/ for Task/Agent usage"
    - "Identify duplicate class definitions"
    - "Identify inconsistent representations of same concept"
    - "Map import relationships and dependencies"
    - "Propose consolidation strategy"
  
  focus_areas:
    - "Task representation (YAML schema vs Python classes)"
    - "Agent representation (profiles vs runtime classes)"
    - "Status tracking (TaskStatus enum vs string states)"
    - "Configuration objects (LLM config vs framework config)"
    - "Model abstractions (execution models vs routing models)"

# Constraints
constraints:
  do:
    - "Focus on src/ directory only (llm_service + framework + orchestration)"
    - "Look for conceptual duplication, not code duplication"
    - "Consider future state after proposed refactoring"
    - "Check if framework abstractions are actually used by llm_service"
    - "Identify shared types that should be in framework/core/"
  
  dont:
    - "Don't analyze tools/ or validation/ directories"
    - "Don't propose implementation details yet"
    - "Don't make code changes - analysis only"
    - "Don't get sidetracked by minor implementation differences"
  
  time_box: 240  # 4 hours

# Reference patterns to look for
patterns_to_identify:
  duplication:
    - "Multiple Task class definitions"
    - "Different Agent base classes"
    - "Inconsistent status enums/strings"
    - "Duplicate configuration schemas"
    - "Redundant validation logic"
  
  inconsistency:
    - "framework/core defines Task, but llm_service uses custom Task"
    - "Agent abstraction exists but isn't used consistently"
    - "Status tracked as enum in one place, strings in another"
    - "Configuration objects duplicated instead of shared"
  
  missing_abstractions:
    - "Common patterns that should be abstracted but aren't"
    - "Utilities duplicated across modules"
    - "Type definitions that should be in framework/core/"

# Output format
output_format: |
  ## Concept Inventory
  
  For each major concept:
  - Definition/Purpose
  - Current implementations (with file paths)
  - Usage examples
  - Duplication analysis
  - Consistency score (high/medium/low)
  
  ## Dependency Map
  
  Visual or text representation of:
  - What uses what
  - Circular dependencies
  - Abstraction leakage
  
  ## Consolidation Recommendations
  
  For each identified issue:
  - Description
  - Severity (high/medium/low)
  - Proposed solution
  - Effort estimate
  - Dependencies/blockers

# Examples of what to look for
examples:
  good_abstraction_usage: |
    # Good: llm_service imports and uses framework abstractions
    from framework.core import Task, TaskStatus
    
    task = Task(id="123", status=TaskStatus.IN_PROGRESS)
  
  bad_duplication: |
    # Bad: llm_service defines own Task class
    class Task:
        def __init__(self, id, status):
            self.id = id
            self.status = status  # string instead of enum
  
  inconsistent_usage: |
    # Inconsistent: mixing framework and custom representations
    from framework.core import Task
    
    # But then ignoring framework's TaskStatus enum
    task.status = "in_progress"  # should use TaskStatus.IN_PROGRESS

# Tags for searchability
tags:
  - "refactoring"
  - "architecture"
  - "technical-debt"
  - "abstraction-review"
  - "code-analysis"

# Notes for agent
notes: |
  This task is preparation for the larger refactoring effort documented in:
  work/reports/analysis/2026-02-08-code-refactoring-proposal.md
  
  Before we move code around, we need to understand what we have and ensure
  we're not duplicating abstractions across modules.
  
  Key question: Does llm_service actually use framework abstractions, or does
  it reinvent them? If reinventing, should we consolidate?
  
  Focus on CONCEPTUAL duplication (same idea represented differently) rather
  than CODE duplication (same code copy-pasted).
