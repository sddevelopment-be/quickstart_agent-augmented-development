---
id: 2026-02-09T2036-python-pedro-integration-testing
agent: python-pedro
status: new
priority: high
phase: testing
specification: specifications/initiatives/dashboard-enhancements/orphan-task-assignment.md
feature: "All features (end-to-end validation)"
title: "Integration Testing: Orphan Task Assignment Feature"
created: 2026-02-09T20:36:00Z
created_by: planning-petra
estimated_hours: 2
artefacts:
  - tests/integration/test_orphan_task_assignment.py
  - tests/integration/test_spec_cache_performance.py
description: |
  # Task: Integration Testing - Orphan Task Assignment
  
  ## Context
  
  **Specification:** SPEC-DASH-008 v1.0.0
  **Architecture Review:** APPROVED
  **Completed Tasks:**
  1. Backend API endpoint (Task 1)
  2. Frontmatter caching (Task 2)
  3. Frontend modal UI (Task 3)
  
  ## Objective
  
  Create comprehensive integration tests to validate end-to-end functionality, performance requirements, and edge cases for orphan task assignment feature.
  
  ## Test Coverage Requirements
  
  ### 1. End-to-End Assignment Flow
  ```python
  def test_assign_orphan_task_to_feature_e2e():
      """
      AC1: Full flow from modal open to task assignment
      
      Steps:
      1. Create orphan task in inbox/
      2. Open dashboard in test client
      3. Click "Assign" button (simulate)
      4. Select initiative and feature (simulate)
      5. Verify PATCH request sent
      6. Verify task YAML updated
      7. Verify WebSocket event emitted
      8. Verify task moved to portfolio section
      """
  ```
  
  ### 2. Concurrent Edit Conflict Detection
  ```python
  def test_concurrent_assignment_conflict():
      """
      AC3: Optimistic locking via file modification time
      
      Steps:
      1. Load task file, capture modification time
      2. Modify task file externally (simulate another user)
      3. Attempt assignment via API
      4. Verify 409 Conflict response
      5. Verify conflict dialog shown in UI
      """
  ```
  
  ### 3. YAML Comment Preservation
  ```python
  def test_yaml_comment_preservation():
      """
      FR-M5: Preserve comments and structure
      
      Steps:
      1. Create task YAML with inline comments
      2. Assign task to specification
      3. Re-read task YAML
      4. Verify comments still present
      5. Verify field order unchanged
      6. Verify blank lines preserved
      """
  ```
  
  ### 4. Performance Requirements
  ```python
  def test_modal_load_performance():
      """
      NFR-P1: Modal load <500ms (P95)
      
      Measure:
      - Time from button click to modal fully rendered
      - P95 percentile over 100 requests
      - Assert: p95 < 500ms
      """
  
  def test_frontmatter_cache_performance():
      """
      NFR-P2: Frontmatter parsing <200ms per spec
      
      Measure:
      - Initial load time for 50 specs
      - Cached read time
      - Cache invalidation time
      - Assert: initial < 2s, cached < 50ms, invalidation < 100ms
      """
  
  def test_yaml_write_performance():
      """
      NFR-P3: YAML write <300ms (P95)
      
      Measure:
      - Time from API request to file written + WebSocket emitted
      - P95 percentile over 100 requests
      - Assert: p95 < 300ms
      """
  ```
  
  ### 5. Security Validation
  ```python
  def test_directory_traversal_prevention():
      """
      NFR-SEC1: Directory traversal attack prevention
      
      Test cases:
      - specification: "../../../etc/passwd"
      - specification: "../../.env"
      - specification: "/etc/hosts"
      
      Verify:
      - All return 400 Bad Request
      - No file access outside specifications/
      """
  
  def test_xss_prevention_in_modal():
      """
      NFR-SEC2: XSS prevention via DOMPurify
      
      Test cases:
      - Task title with <script>alert('xss')</script>
      - Feature name with <img src=x onerror=alert('xss')>
      
      Verify:
      - Scripts sanitized before rendering
      - No JavaScript execution in modal
      """
  ```
  
  ### 6. Edge Cases
  ```python
  def test_missing_specification_file():
      """
      AC5: Handle missing specification gracefully
      """
  
  def test_malformed_specification_yaml():
      """
      NFR-R2: Graceful degradation for invalid specs
      """
  
  def test_specification_without_features():
      """
      FR-M9: Handle specs without feature structure
      """
  
  def test_websocket_event_emission():
      """
      FR-M6: Verify task.assigned + task.updated events
      """
  ```
  
  ## Testing Strategy
  
  ### Unit Tests (Per Component)
  - Backend endpoint: Validation, locking, YAML writing
  - Spec cache: Cache hit/miss, invalidation, file watching
  - Frontend: (Manual testing for UI interactions)
  
  ### Integration Tests (This Task)
  - End-to-end flows
  - Performance benchmarks
  - Security validations
  - Edge case handling
  
  ### Acceptance Tests (ATDD)
  - Map directly to specification acceptance criteria
  - Given/When/Then format
  - Executable via pytest
  
  ## Success Criteria
  
  - [ ] All 20+ integration tests passing
  - [ ] Performance requirements met (P95):
    - Modal load <500ms ✅
    - Frontmatter parsing <200ms ✅
    - YAML write <300ms ✅
  - [ ] Security validations pass ✅
  - [ ] Edge cases handled gracefully ✅
  - [ ] Test coverage >80% for new code ✅
  
  ## Dependencies
  - All 3 implementation tasks completed (backend, caching, frontend)
  
  ## Handoff
  **Next:** Code review and merge (Phase 6)
  **Reviewer:** Code Reviewer Cindy or Architect Alphonso
