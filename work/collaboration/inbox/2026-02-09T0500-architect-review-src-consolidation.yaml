---
id: 2026-02-09T0500-architect-review-src-consolidation
agent: architect
status: inbox
priority: high
phase: review
title: "Review Src/ Consolidation Strategy and Create ADRs"
created: 2026-02-09T05:00:00Z
description: |
  # Task: Architect Review - Src/ Consolidation Strategy

  ## Context

  **Analysis Reports:**
  - `work/reports/analysis/2026-02-09-src-concept-duplication-inventory.md` (23 KB)
  - `work/reports/analysis/2026-02-09-src-abstraction-dependencies.md` (33 KB)
  - `work/reports/logs/python-pedro/2026-02-09-src-duplicates-analysis.md` (18 KB)

  **Completed By:** Python Pedro (2026-02-09)
  **Total Analysis:** 74 KB comprehensive documentation

  ## Objective

  Review Python Pedro's src/ concept duplication analysis and consolidation strategy. Validate architectural recommendations, create required ADRs, and provide architectural guidance for the proposed 4-phase refactoring plan.

  ## Key Findings to Review

  ### High-Priority Issues
  1. **Task I/O Duplication**
   - `framework/orchestration/task_utils.read_task()`
   - `llm_service/dashboard/task_linker.load_task()`
   - Severity: HIGH (maintenance burden, inconsistency risk)

  2. **Status String Values**
   - No enum enforcement for task/feature status
   - Risk: Typos, inconsistency, no IDE support
   - Severity: HIGH (data quality, error-prone)

  3. **Agent Identity**
   - Not type-safe between orchestration and configuration
   - Current: String-based lookups
   - Severity: MEDIUM (runtime errors possible)

  ### Positive Architecture Findings
  - ✅ Zero circular dependencies
  - ✅ Clean module boundaries (framework vs llm_service)
  - ✅ Appropriate separation of runtime vs static concerns

  ### Proposed Solution
  **Pattern:** "Shared Core" with `src/common/` abstractions
  **Effort:** 28 hours across 4 phases
  **Risk:** Low to Medium (phased approach, good test coverage)

  ## Deliverables

  ### 1. Architectural Review Document
  **File:** `work/reports/architecture/2026-02-09-src-consolidation-review.md`

  **Sections:**
  - Executive summary of review findings
  - Validation of consolidation strategy
  - Risk assessment for 4-phase plan
  - Alternative approaches (if any)
  - Approval status: APPROVED / REDIRECT / BLOCKED
  - Implementation prerequisites
  - Success metrics

  ### 2. Architecture Decision Records (ADRs)

  **ADR-XXX: Shared Domain Model for Task Abstractions**
  - **Decision:** Create `src/common/task_schema.py` for unified task I/O
  - **Context:** Task reading duplicated across framework and llm_service
  - **Consequences:** Single source of truth, easier maintenance, migration effort
  - **Status:** Proposed
  - **File:** `docs/architecture/adrs/ADR-XXX-shared-task-domain-model.md`

  **ADR-XXX: Status Enumeration and Lifecycle**
  - **Decision:** Enforce TaskStatus and FeatureStatus enums
  - **Context:** Current string values error-prone, no validation
  - **Consequences:** Type safety, IDE support, breaking change
  - **Status:** Proposed
  - **File:** `docs/architecture/adrs/ADR-XXX-status-enumeration-standard.md`

  **ADR-XXX: Framework Configuration Standards**
  - **Decision:** Define configuration boundaries and shared types
  - **Context:** Agent identity not type-safe between modules
  - **Consequences:** Better type safety, refactoring required
  - **Status:** Proposed (Optional - defer if low impact)
  - **File:** `docs/architecture/adrs/ADR-XXX-configuration-standards.md`

  ### 3. Refactoring Task Breakdown
  **File:** `work/collaboration/inbox/2026-02-09-TXXX-refactoring-phase-N.yaml` (4 tasks)

  **Phase 1 Task:** Create Shared Foundation (6h, Low Risk)
  - Create `src/common/types.py` with TaskStatus, FeatureStatus enums
  - Create `src/common/task_schema.py` with unified read/write functions
  - Add tests for new abstractions (TDD)

  **Phase 2 Task:** Update Framework (10h, Medium Risk)
  - Replace status strings with enums in framework/orchestration/
  - Use shared task I/O functions
  - Update tests

  **Phase 3 Task:** Update LLM Service (8h, Low Risk)
  - Replace load_task() with shared implementation
  - Use TaskStatus enum in dashboard
  - Update tests

  **Phase 4 Task:** Validation & Cleanup (4h, Low Risk)
  - Full test suite execution
  - Remove deprecated code paths
  - Documentation updates

  ## Acceptance Criteria

  ### Architectural Review
  - [ ] All analysis reports reviewed thoroughly
  - [ ] Consolidation strategy validated or redirected
  - [ ] Risk assessment completed for 4-phase plan
  - [ ] Alternative approaches considered (if applicable)
  - [ ] Review document created with clear approval status
  - [ ] Implementation prerequisites documented

  ### ADR Creation
  - [ ] At least 2 ADRs created (Task Domain Model + Status Enumeration)
  - [ ] Each ADR follows standard format (Context → Decision → Consequences)
  - [ ] ADRs reference analysis reports
  - [ ] ADRs include migration strategy
  - [ ] ADRs linked to refactoring tasks

  ### Task Breakdown
  - [ ] 4 refactoring tasks created (one per phase)
  - [ ] Each task has clear acceptance criteria
  - [ ] Tasks reference relevant ADRs
  - [ ] Dependencies specified between tasks
  - [ ] Effort estimates validated or adjusted

  ### Quality Gates
  - [ ] Review aligns with existing architecture (ADR-012, ADR-017, etc.)
  - [ ] Test coverage strategy defined for refactoring
  - [ ] Rollback plan documented (if consolidation fails)
  - [ ] Performance impact assessed
  - [ ] Breaking change mitigation planned

  ## Dependencies

  **Requires:** Python Pedro's analysis reports (✅ Complete)
  **Blocks:** All 4 refactoring tasks (Phase 1-4)

  ## Estimated Time

  - Analysis review: 2 hours
  - ADR creation: 3 hours (2-3 ADRs)
  - Task breakdown: 2 hours
  - Documentation: 1 hour
  **Total:** 8 hours

  ## Related Directives

  - Directive 018: Traceable Decisions (ADR creation)
  - Directive 014: Work Log Creation
  - Directive 020: Locality of Change (phased approach)
  - Directive 017: TDD (test-first refactoring)

  ## Review Focus Areas

  ### 1. Consolidation Strategy Validation
  - Is "Shared Core" pattern appropriate for this codebase?
  - Are 4 phases the right granularity? (too fine? too coarse?)
  - Is 28-hour estimate realistic?
  - Are risks properly assessed?

  ### 2. Architectural Alignment
  - Does proposal align with existing ADRs?
  - Does it support future dashboard enhancements?
  - Does it maintain clean module boundaries?
  - Does it avoid premature abstraction?

  ### 3. Implementation Concerns
  - Are migration steps clear and safe?
  - Is test coverage adequate?
  - Are breaking changes acceptable?
  - Is rollback plan sufficient?

  ### 4. Alternative Approaches
  - Could we defer consolidation? (when would it be mandatory?)
  - Could we use a lighter-weight approach? (e.g., adapter pattern)
  - Could we consolidate in different order? (llm_service first?)

  ## Notes for Architect Alphonso

  **Why This Review Matters:**
  - High-priority duplications affect maintainability
  - Proposed changes touch both framework and llm_service
  - 28 hours of effort needs architectural validation
  - ADRs will guide future development

  **Expected Outcome:**
  - APPROVED: Create ADRs, proceed with Phase 1
  - REDIRECT: Modify approach, adjust strategy
  - BLOCKED: Defer consolidation, address prerequisites

  **Recommended Approach:**
  1. Read analysis reports thoroughly (1 hour)
  2. Validate findings against codebase (30 min)
  3. Assess consolidation strategy (30 min)
  4. Create ADRs for approved decisions (3 hours)
  5. Break down into refactoring tasks (2 hours)
  6. Document review findings (1 hour)

  ---

  **Status:** INBOX - Ready for Architect Alphonso
  **Created:** 2026-02-09T05:00:00Z
  **Priority:** HIGH (blocks refactoring work)
