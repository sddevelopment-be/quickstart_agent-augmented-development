---
# Task Descriptor: ADR-046 Task 3 - Update Import Statements
id: "2026-02-11T1100-adr046-task3-update-imports"
title: "ADR-046 Task 3: Update Import Statements Across Codebase"
assignee: python-pedro
batch: "M5.1"
priority: CRITICAL
status: assigned
created: "2026-02-11T11:00:00Z"
specification: "docs/architecture/adrs/ADR-046-domain-module-refactoring.md"
related_decisions:
  - "docs/architecture/adrs/ADR-046-domain-module-refactoring.md"
dependencies:
  - type: prerequisite
    task_id: "2026-02-11T1100-adr046-task2-move-files"
    description: "Files must be moved before imports can be updated"
blocks:
  - "2026-02-11T1100-adr046-task4-validate-refactor"
estimated_hours: 3-4
tags:
  - adr-046
  - domain-refactoring
  - import-updates
  - breaking-changes
---

# Task: Update Import Statements Across Codebase

## Context

**Initiative:** M5 Batch 5.1 - Conceptual Alignment Foundation  
**ADR:** ADR-046 (Domain Module Refactoring)  
**Strategic Goal:** Fix ~50 files with updated import paths after bounded context migration

**Why This Matters:**
- Restores codebase functionality after file moves
- Completes bounded context separation
- Enables team to resume normal development
- Critical blocker - no other work can proceed until complete

## Objective

Update all import statements from `src.common.*` to `src.domain.{context}.*` across ~50 files. Use automated tools where possible. Execute during coordinated low-activity window.

## Acceptance Criteria

**MUST:**
- [ ] All imports updated from `src.common.*` to `src.domain.{context}.*`
- [ ] Automated with ast-grep or similar tool
- [ ] Tests pass after each batch of changes (incremental validation)
- [ ] Changes committed incrementally (per bounded context)
- [ ] Team notified BEFORE execution start
- [ ] Team notified AFTER execution complete

**SHOULD:**
- [ ] Script used for automation (reusable, documented)
- [ ] Dry-run executed first (preview changes)
- [ ] Rollback plan documented (in case of issues)

**MUST NOT:**
- [ ] Change import logic (only paths, not semantics)
- [ ] Modify file contents beyond imports
- [ ] Execute during peak team activity hours

## Deliverables

1. **Import Update Script:**
   - `tools/migration/update_domain_imports.py` - Automated import updater
   - Dry-run mode for preview
   - Per-context execution mode

2. **Git Commits:**
   - Commit 1: Update collaboration imports
   - Commit 2: Update doctrine imports
   - Commit 3: Update specifications imports
   - Commit 4: Update common imports

3. **Validation Report:**
   - `work/coordination/adr046-import-update-report.md`
   - Files changed count
   - Test results per batch
   - Rollback procedure

## Test Plan

**Verification Steps:**
1. Run import script in dry-run mode
2. Review proposed changes (spot-check)
3. Execute batch 1 (collaboration imports)
4. Run tests ‚Üí MUST PASS
5. Execute batch 2 (doctrine imports)
6. Run tests ‚Üí MUST PASS
7. Execute batch 3 (specifications imports)
8. Run tests ‚Üí MUST PASS
9. Execute batch 4 (common imports)
10. Run full test suite ‚Üí MUST PASS

**Test Commands:**
```bash
# Dry-run to preview changes
python tools/migration/update_domain_imports.py --dry-run

# Execute batch 1
python tools/migration/update_domain_imports.py --context collaboration
pytest tests/ -k "collaboration"  # Must pass

# Execute batch 2
python tools/migration/update_domain_imports.py --context doctrine
pytest tests/ -k "doctrine"  # Must pass

# Execute batch 3
python tools/migration/update_domain_imports.py --context specifications
pytest tests/ -k "specifications"  # Must pass

# Execute batch 4
python tools/migration/update_domain_imports.py --context common
pytest tests/  # Full suite must pass
```

## Implementation Notes

### Import Update Script Structure

```python
# tools/migration/update_domain_imports.py

import ast
import sys
from pathlib import Path

# Mapping: old import ‚Üí new import
IMPORT_MAPPINGS = {
    "src.common.task_schema": "src.domain.collaboration.task_schema",
    "src.common.orchestrator": "src.domain.collaboration.orchestrator",
    "src.common.agent_loader": "src.domain.doctrine.agent_loader",
    "src.common.directive_parser": "src.domain.doctrine.directive_parser",
    # ... etc
}

def update_imports(file_path: Path, dry_run: bool = False):
    """Update imports in file using AST manipulation."""
    # Implementation details
    pass

# Execution per context for incremental validation
```

### Automated Tool Options

**Option 1: ast-grep (Recommended)**
```bash
# Find and replace import patterns
ast-grep --pattern 'from src.common.$MODULE import $NAME' \
         --rewrite 'from src.domain.collaboration.$MODULE import $NAME' \
         src/**/*.py
```

**Option 2: Python AST Script**
- More control for complex imports
- Can handle relative imports
- Preserves formatting

**Option 3: sed (Last Resort)**
```bash
# Simple pattern replacement (fragile)
find src tests -name "*.py" -exec sed -i \
  's/from src\.common\./from src.domain.collaboration./g' {} +
```

### Coordination Window

**Timing:**
- Notify team 30min before start
- Execute during low-activity period
- Estimated duration: 1-2 hours (including validation)
- Post completion notice immediately

**Communication Template:**
```
üö® BREAKING CHANGE IN PROGRESS üö®
ADR-046 Task 3: Import updates starting NOW
Duration: 1-2 hours
Action: Pause PRs, pull fresh main after completion
Status updates: Every 30min
```

## Risk Assessment

**RISK:** High (breaking changes across entire codebase)

**Mitigation:**
- Incremental batches (easy to isolate failures)
- Test after each batch (fast feedback)
- Automated script (reduce human error)
- Dry-run first (preview changes)
- Feature branch execution (not main)
- Team coordination (minimize conflicts)

**Rollback Plan:**
```bash
# If batch fails, revert specific commit
git log --oneline -5  # Find problematic commit
git revert <commit-hash>

# If catastrophic failure, revert entire branch
git reset --hard origin/main
```

## Definition of Done

- [ ] All ~50 files updated with new import paths
- [ ] No remaining `from src.common.*` imports (except deprecation stubs)
- [ ] All tests pass (unit, integration, full suite)
- [ ] Changes committed incrementally by context
- [ ] Import update script saved to `tools/migration/`
- [ ] Validation report created
- [ ] Team notified of completion
- [ ] Task 4 unblocked (validation and documentation)

## References

- **ADR:** `docs/architecture/adrs/ADR-046-domain-module-refactoring.md`
- **Migration Guide:** `src/common/MIGRATION_GUIDE.md` (created in Task 2)
- **Planning:** `docs/planning/NEXT_BATCH.md` (M5.1)

---

**Estimated Effort:** 3-4 hours  
**Agent:** Backend Dev  
**Batch:** M5 Batch 5.1 - Conceptual Alignment Foundation  
**Priority:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê CRITICAL (unblocks entire team)
