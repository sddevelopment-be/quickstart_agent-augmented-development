id: 2026-02-09T2035-frontend-orphan-task-modal
agent: frontend
status: assigned
priority: high
phase: implementation
specification: specifications/initiatives/dashboard-enhancements/orphan-task-assignment.md
feature: 'FEAT-DASH-008-02: Interactive Specification/Feature Selector'
title: 'Frontend: Orphan Task Assignment Modal UI'
created: 2026-02-09 20:35:00+00:00
created_by: planning-petra
estimated_hours: 3
artefacts:
- src/llm_service/dashboard/templates/dashboard.html
- src/llm_service/dashboard/static/js/assignment-modal.js
- src/llm_service/dashboard/static/css/assignment-modal.css
description: "# Task: Frontend Modal UI for Orphan Task Assignment\n\n## Context\n\
  \n**Specification:** SPEC-DASH-008 v1.0.0\n**Architecture Review:** APPROVED\n**Performance\
  \ Requirement:** NFR-P1 - Modal load <500ms (P95)\n\n**Architectural Decisions:**\n\
  - Modal UI pattern consistent with task priority editing (ADR-035)\n- Client-side\
  \ search filtering (no backend round-trip)\n- Feature-level assignment granularity\n\
  \n## Objective\n\nCreate modal UI for assigning orphan tasks to specifications/features\
  \ with hierarchical initiative display, search filtering, and real-time updates.\n\
  \n## Acceptance Criteria (ATDD)\n\n**AC1: Open Assignment Modal**\n```gherkin\n\
  Given I have an orphan task displayed\nWhen I click the \"Assign\" button\nThen\
  \ the assignment modal opens within 500ms\nAnd the modal displays:\n  - Task preview\
  \ (title, agent, priority)\n  - Initiative hierarchy (collapsed)\n  - Search bar\
  \ at top\n```\n\n**AC2: Expand Initiative and Select Feature**\n```gherkin\nGiven\
  \ the assignment modal is open\nWhen I expand the \"Dashboard Enhancements\" initiative\n\
  Then I see the features list:\n  - Feature 1: Orphan Task Detection\n  - Feature\
  \ 2: Interactive Selector\n  - Feature 3: YAML File Update\nAnd each feature has\
  \ an \"Assign to [Feature]\" button\n```\n\n**AC3: Assign Task to Feature**\n```gherkin\n\
  Given the assignment modal is open\nAnd I have expanded \"Dashboard Enhancements\"\
  \nWhen I click \"Assign to Feature 2: Interactive Selector\"\nThen the modal shows\
  \ loading state\nAnd a PATCH request is sent to /api/tasks/:id/specification\nAnd\
  \ on success (200):\n  - Success toast appears: \"Task assigned to Interactive Selector\"\
  \n  - Modal closes\n  - Task disappears from orphan section\n  - Task appears in\
  \ portfolio under correct initiative/feature\n```\n\n**AC4: Handle Assignment Conflict**\n\
  ```gherkin\nGiven the assignment modal is open\nWhen I click \"Assign to Feature\
  \ X\"\nAnd the backend returns 409 Conflict\nThen a conflict dialog appears:\n \
  \ \"This task was modified by another user. Refresh and try again?\"\n  [Refresh]\
  \ [Cancel]\nAnd the modal remains open\n```\n\n**AC5: Search/Filter Initiatives**\n\
  ```gherkin\nGiven the assignment modal is open with 20 initiatives\nWhen I type\
  \ \"dashboard\" in the search bar\nThen only initiatives/features matching \"dashboard\"\
  \ are displayed\nAnd the filter completes in <100ms (client-side)\n```\n\n**AC6:\
  \ Keyboard Navigation**\n```gherkin\nGiven the assignment modal is open\nWhen I\
  \ press Tab\nThen focus moves to next interactive element\nAnd when I press Escape\n\
  Then the modal closes\nAnd when I press Enter on \"Assign\" button\nThen the assignment\
  \ is executed\n```\n\n## Implementation Guidance\n\n### Modal Component Structure\n\
  ```html\n<!-- AssignmentModal -->\n<div id=\"assignment-modal\" class=\"modal hidden\"\
  >\n  <div class=\"modal-content\">\n    <!-- Task Preview -->\n    <div class=\"\
  task-preview\">\n      <h3 id=\"task-title\"></h3>\n      <div class=\"task-meta\"\
  >\n        <span class=\"badge agent\"></span>\n        <span class=\"badge priority\"\
  ></span>\n      </div>\n    </div>\n    \n    <!-- Search Bar -->\n    <input \n\
  \      type=\"text\" \n      id=\"spec-search\" \n      placeholder=\"Search initiatives\
  \ or features...\"\n      class=\"search-input\"\n    />\n    \n    <!-- Initiative\
  \ List -->\n    <div id=\"initiative-list\" class=\"initiative-list\">\n      <!--\
  \ Dynamically populated -->\n    </div>\n    \n    <!-- Loading State -->\n    <div\
  \ id=\"loading-state\" class=\"hidden\">\n      <span class=\"spinner\"></span>\n\
  \      <p>Assigning task...</p>\n    </div>\n    \n    <!-- Conflict Dialog -->\n\
  \    <div id=\"conflict-dialog\" class=\"hidden\">\n      <p>This task was modified\
  \ by another user.</p>\n      <div class=\"dialog-actions\">\n        <button onclick=\"\
  refreshModal()\">Refresh</button>\n        <button onclick=\"closeModal()\">Cancel</button>\n\
  \      </div>\n    </div>\n  </div>\n</div>\n```\n\n### JavaScript Implementation\n\
  ```javascript\n// src/llm_service/dashboard/static/js/assignment-modal.js\n\nlet\
  \ currentTaskId = null;\nlet initiatives = [];\n\nasync function openAssignmentModal(taskId)\
  \ {\n  currentTaskId = taskId;\n  \n  // Show modal\n  document.getElementById('assignment-modal').classList.remove('hidden');\n\
  \  \n  // Load task preview\n  const task = await fetchTask(taskId);\n  displayTaskPreview(task);\n\
  \  \n  // Load initiatives (from cached spec list)\n  initiatives = await fetchInitiatives();\n\
  \  renderInitiativeList(initiatives);\n}\n\nfunction renderInitiativeList(initiatives)\
  \ {\n  const listEl = document.getElementById('initiative-list');\n  listEl.innerHTML\
  \ = '';\n  \n  initiatives.forEach(initiative => {\n    const initiativeEl = createInitiativeElement(initiative);\n\
  \    listEl.appendChild(initiativeEl);\n  });\n}\n\nfunction createInitiativeElement(initiative)\
  \ {\n  const div = document.createElement('div');\n  div.className = 'initiative-item\
  \ collapsed';\n  \n  div.innerHTML = `\n    <div class=\"initiative-header\" onclick=\"\
  toggleInitiative('${initiative.id}')\">\n      <span class=\"expand-icon\">\u25B6\
  </span>\n      <h4>${initiative.title}</h4>\n    </div>\n    <div class=\"feature-list\
  \ hidden\">\n      ${initiative.features.map(feature => `\n        <div class=\"\
  feature-item\">\n          <span>${feature.title}</span>\n          <button \n \
  \           class=\"btn-assign\"\n            onclick=\"assignTask('${initiative.spec_path}',\
  \ '${feature.title}')\">\n            Assign to ${feature.title}\n          </button>\n\
  \        </div>\n      `).join('')}\n    </div>\n  `;\n  \n  return div;\n}\n\n\
  async function assignTask(specPath, featureName) {\n  // Show loading state\n  document.getElementById('loading-state').classList.remove('hidden');\n\
  \  \n  try {\n    const response = await fetch(`/api/tasks/${currentTaskId}/specification`,\
  \ {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json'\
  \ },\n      body: JSON.stringify({\n        specification: specPath,\n        feature:\
  \ featureName\n      })\n    });\n    \n    if (response.ok) {\n      showSuccessToast(`Task\
  \ assigned to ${featureName}`);\n      closeModal();\n      refreshPortfolio();\n\
  \    } else if (response.status === 409) {\n      showConflictDialog();\n    } else\
  \ {\n      const error = await response.json();\n      showErrorToast(error.message);\n\
  \    }\n  } catch (error) {\n    showErrorToast('Failed to assign task');\n  } finally\
  \ {\n    document.getElementById('loading-state').classList.add('hidden');\n  }\n\
  }\n\n// Search/filter function\ndocument.getElementById('spec-search').addEventListener('input',\
  \ (e) => {\n  const query = e.target.value.toLowerCase();\n  const filtered = initiatives.filter(init\
  \ => \n    init.title.toLowerCase().includes(query) ||\n    init.features.some(f\
  \ => f.title.toLowerCase().includes(query))\n  );\n  renderInitiativeList(filtered);\n\
  });\n```\n\n### CSS Styling\n```css\n/* src/llm_service/dashboard/static/css/assignment-modal.css\
  \ */\n\n.modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height:\
  \ 100%;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n\
  \  justify-content: center;\n  z-index: 1000;\n}\n\n.modal.hidden {\n  display:\
  \ none;\n}\n\n.modal-content {\n  background: white;\n  width: 600px;\n  max-height:\
  \ 80vh;\n  border-radius: 8px;\n  padding: 24px;\n  overflow-y: auto;\n}\n\n.task-preview\
  \ {\n  border-bottom: 1px solid #ddd;\n  padding-bottom: 16px;\n  margin-bottom:\
  \ 16px;\n}\n\n.search-input {\n  width: 100%;\n  padding: 8px 12px;\n  border: 1px\
  \ solid #ccc;\n  border-radius: 4px;\n  margin-bottom: 16px;\n}\n\n.initiative-item\
  \ {\n  margin-bottom: 12px;\n}\n\n.initiative-header {\n  cursor: pointer;\n  padding:\
  \ 8px;\n  background: #f5f5f5;\n  border-radius: 4px;\n  display: flex;\n  align-items:\
  \ center;\n}\n\n.feature-list {\n  padding-left: 24px;\n  margin-top: 8px;\n}\n\n\
  .feature-list.hidden {\n  display: none;\n}\n\n.btn-assign {\n  background: #007bff;\n\
  \  color: white;\n  border: none;\n  padding: 6px 12px;\n  border-radius: 4px;\n\
  \  cursor: pointer;\n}\n\n.btn-assign:hover {\n  background: #0056b3;\n}\n```\n\n\
  ## Testing Strategy\n- **Manual Testing:** Full user flow (open modal \u2192 search\
  \ \u2192 assign \u2192 verify)\n- **Performance:** Modal load time <500ms, search\
  \ filter <100ms\n- **Accessibility:** Tab navigation, Escape to close, screen reader\
  \ support\n\n## Dependencies\n- Backend endpoint `/api/tasks/:id/specification`\
  \ (Task 1)\n- Spec cache for fast initiative list (Task 2)\n\n## Handoff\n**Next:**\
  \ Integration testing task (end-to-end validation)\n"
assigned_at: '2026-02-09T21:14:03.391906Z'
