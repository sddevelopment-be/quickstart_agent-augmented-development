id: 2025-11-30T1201-build-automation-model-router-config
agent: build-automation
status: assigned
priority: high
mode: /analysis-mode
title: Build router configuration and validator from Platform Next Steps
artefacts:
- ops/config/model_router.yaml
- ops/scripts/validate-model-router.py
- work/logs/build-automation/2025-11-30T1201-build-automation-model-router-config.md
description: 'Create the dual-router configuration and validation script described
  in

  docs/architecture/assessments/platform_next_steps.md so orchestration can

  deterministically select models and fall back across OpenRouter and

  OpenCode.ai.

  '
context:
  repo: sddevelopment-be/quickstart_agent-augmented-development
  branch: main
  source_assessment: docs/architecture/assessments/platform_next_steps.md
  notes:
  - Capture model aliases and raw IDs covering GPT-5/4.1, Claude Opus/Sonnet, Codestral,
    DeepSeek, and Llama3 family members.
  - Encode fallback order plus pricing ceilings per provider.
  - Provide clear schema comments so future agents can extend the catalog.
requirements:
- Author ops/config/model_router.yaml with metadata for each supported model, including
  router (`openrouter`, `opencode_ai`, `direct_api`), raw identifier, context window,
  price per 1K input/output tokens, and default role.
- Document fallback policies and pricing ceilings (USD) per provider.
- Implement ops/scripts/validate-model-router.py that loads the config, validates
  schema, checks that fallback references exist, and confirms context windows and
  pricing are within defined ceilings.
- Provide CLI usage examples (`--file`, `--strict`) in the validator docstring.
- Output validation summary suitable for CI plus non-zero exit on failure.
testing_requirements:
- Include unit tests covering happy path, missing model definitions, invalid fallback
  references, and pricing ceiling violations.
- Follow directives 016/017 (ATDD/TDD) with acceptance cases before code.
- Capture validator execution logs inside work/logs/build-automation/.
success_criteria:
- Model router config committed with complete catalog and fallback rules.
- Validator exits successfully against the new config and fails when introducing deliberate
  schema errors during tests.
- Work log summarizes design decisions and validation output.
created_at: '2025-11-30T12:01:00Z'
created_by: planning-petra
assigned_at: '2026-01-31T06:38:02.620980Z'
