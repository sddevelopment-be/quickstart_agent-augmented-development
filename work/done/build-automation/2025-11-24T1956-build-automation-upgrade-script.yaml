id: 2025-11-24T1956-build-automation-upgrade-script
agent: build-automation
status: assigned
title: Implement framework_upgrade.sh Script with Conflict Detection
priority: high
artefacts:
- scripts/framework_upgrade.sh
- scripts/tests/test_framework_upgrade.sh
- docs/HOW_TO_USE/framework-upgrades.md
context:
  notes:
  - Implements ADR-013 upgrade workflow with conflict detection
  - Supports --dry-run flag for preview without changes
  - 'For each file: compare checksums, classify as NEW/UNCHANGED/CONFLICT'
  - 'Divergent files: write <path>.framework-new, create backup, log CONFLICT'
  - Never modifies local/** directories or deletes files
  - Generates upgrade-report.txt with counts per status
  - Updates .framework_meta.yml only in non-dry-run mode
  - Use sha256sum for checksum comparison
  references:
  - docs/architecture/adrs/ADR-013-zip-distribution.md
  - docs/architecture/design/distribution_of_releases_technical_design.md
  dependencies:
  - 2025-11-24T1954-build-automation-packaging-pipeline (for MANIFEST.yml)
  - 2025-11-24T1955-build-automation-install-script (for .framework_meta.yml format)
  quality_criteria:
  - POSIX-compliant (shellcheck validation)
  - 'Test suite covers: identical files, new files, conflicts, dry-run'
  - Backup policy documented and tested
  - Clear upgrade-report.txt format
  - Path normalization handles spaces and special characters
metadata:
  created_at: '2025-11-24T19:56:00Z'
  created_by: manager
  estimated_effort: 1.5 days
  related_adrs:
  - ADR-013
assigned_at: '2025-11-24T21:16:08.131777Z'
status: done
completed_at: '2025-11-24T22:01:00Z'
result:
  summary: |
    Created complete framework upgrade script with comprehensive testing:
    - POSIX-compliant upgrade script with conflict detection
    - 7-test suite with 100% pass rate
    - Dry-run support for safe preview
    - Complete user documentation with troubleshooting
  artifacts_created:
    - scripts/framework_upgrade.sh (executable, 8.8KB, shellcheck validated)
    - scripts/tests/test_framework_upgrade.sh (7 tests, 100% pass)
    - docs/HOW_TO_USE/framework-upgrades.md (comprehensive guide, 12KB)
  quality_checks:
    - Shellcheck: Passed (1 minor style suggestion)
    - Test suite: 7/7 tests passed (100%)
    - Conflict detection: Verified with checksums
    - Dry-run mode: Tested and working
  features:
    - Supports --dry-run for preview
    - Creates .framework-new files for conflicts
    - Creates .bak backups of conflicted files
    - Never modifies local/** directories
    - Updates .framework_meta.yml with version history
    - Generates comprehensive upgrade reports
    - Color-coded output for clarity
