# Framework Upgrade Plan

**Generated by:** Framework Guardian  
**Plan Date:** `YYYY-MM-DD HH:MM:SS UTC`  
**Guardian Version:** `X.Y.Z`

---

## Metadata

| Property                  | Value                                    |
|---------------------------|------------------------------------------|
| **Repository**            | `<repository-name>`                      |
| **Source Version**        | `<old-version>`                          |
| **Target Version**        | `<new-version>`                          |
| **Upgrade Script Run**    | `YYYY-MM-DD HH:MM:SS`                    |
| **Upgrade Mode**          | `full` / `incremental`                   |
| **Upgrade Script Output** | `upgrade-report.txt` (or script log)     |

---

## Executive Summary

This upgrade plan analyzes conflicts generated by `framework_upgrade.sh` when upgrading from version `<old>` to `<new>`. It classifies each conflict, provides resolution recommendations, and identifies safe minimal patches to preserve local customizations while adopting framework improvements.

**Status:** ✅ Upgrade Ready / ⚠️ Manual Review Required / ❗️ Blocking Issues

### Summary Statistics

| Metric                              | Count | Percentage |
|-------------------------------------|-------|------------|
| **Total Conflicts**                 | `X`   | 100%       |
| **Auto-Merge Candidates**           | `X`   | `X%`       |
| **Non-Breaking Additions**          | `X`   | `X%`       |
| **Local Customizations Preserved**  | `X`   | `X%`       |
| **Breaking Changes**                | `X`   | `X%`       |
| **New Files (no conflict)**         | `X`   | N/A        |
| **Unchanged Files**                 | `X`   | N/A        |

---

## Conflict Resolution Table

| Path                                      | Conflict Type              | Recommendation                        | Priority   |
|-------------------------------------------|----------------------------|---------------------------------------|------------|
| `agents/architect.agent.md`       | Local Customization        | Manual merge; relocate custom to `local/` | Medium     |
| `directives/010_*.md`      | Non-Breaking Addition      | Safe to adopt; append new sections    | Low        |
| `templates/architecture/ADR.md`      | Breaking Change            | ❗️ Requires manual review            | High       |
| `.github/agents/guidelines/general.md`    | Auto-Merge Candidate       | Whitespace changes only—safe replace  | Low        |

*(Continue for all conflicts...)*

---

## Critical Actions

### ❗️ Blocking Issues (Must Resolve Before Upgrade)

1. **Breaking Changes in Core Governance:**
   - **File:** `directives/006_version_governance.md`
   - **Issue:** Framework has restructured version tracking; local overrides incompatible.
   - **Recommendation:** Review new structure in `META/UPGRADE_NOTES_<version>.md`. Manually port local version references to new schema.
   - **Action:** Manual review required. Do not proceed until resolved.

2. **Security-Critical File Conflict:**
   - **File:** `scripts/framework_upgrade.sh`
   - **Issue:** Local modifications to upgrade script detected; potential security risk if merged incorrectly.
   - **Recommendation:** Restore original script from framework release. If local modifications needed, document rationale and apply as patch after upgrade.
   - **Action:** Security review required before proceeding.

### ⚠️ High-Priority Warnings (Should Resolve Before Upgrade)

1. **Agent Profile with Significant Local Customization:**
   - **File:** `agents/manager.agent.md`
   - **Issue:** Local customizations conflict with new framework directives added in target version.
   - **Recommendation:** Relocate custom responsibilities to `local/agents/manager-custom.agent.md`. Update references.
   - **Action:** Manual merge or relocation before upgrade.

2. **Template Structure Change:**
   - **File:** `templates/architecture/ADR.md`
   - **Issue:** Framework has added required sections; local version missing new fields.
   - **Recommendation:** Adopt new template structure. Existing ADRs remain valid; future ADRs use new template.
   - **Action:** Review and adopt new template.

---

## Per-File Recommendations

### 1. `agents/architect.agent.md`

**Conflict Type:** Local Customization Preserved

**Situation:**
- Local version has custom directives added to directive reference table.
- Framework version adds new directives (022, 023) but does not remove any.

**Diff Highlight:**

```diff
--- agents/architect.agent.md (current)
+++ agents/architect.agent.md.framework-new
@@ Directive References
-| 020  | [Lenient Adherence](...) | Custom strictness levels |
+| 020  | [Lenient Adherence](...) | Maintaining stylistic consistency... |
+| 021  | [Locality Of Change](...) | Knowing when to implement... |
+| 022  | [Audience Oriented Writing](...) | Apply persona-aware targeting... |
```

**Analysis:**
- Framework added directives 021, 022 with official descriptions.
- Local version has customized description for directive 020.
- No structural conflict—addition can be merged.

**Recommendation:**

**Option A (Recommended):** Adopt Framework Changes with Local Note
1. Accept new framework directives 021, 022.
2. Restore official description for directive 020.
3. If custom description was intentional, add note in local agent guidelines: `local/agents/architect-overrides.md`.

**Option B:** Keep Local Version, Document Override
1. Keep current version.
2. Manually append new directives 021, 022 from `.framework-new`.
3. Document directive 020 custom description in project notes.

**Priority:** Medium  
**Action Required:** Manual merge or adopt Option A.

---

### 2. `.github/agents/guidelines/general.md`

**Conflict Type:** Auto-Merge Candidate

**Situation:**
- Framework version has updated whitespace and formatting.
- No content changes detected—only line breaks and indentation adjustments.

**Diff Highlight:**

```diff
--- .github/agents/guidelines/general.md (current)
+++ .github/agents/guidelines/general.md.framework-new
@@ Line 42
-Agents must prioritize clarity and precision.  
+Agents must prioritize clarity and precision.
 
-Tone should remain professional and collaborative.  
+Tone should remain professional and collaborative.
```

**Analysis:**
- Changes are cosmetic (trailing whitespace removal).
- No semantic differences.

**Recommendation:**

✅ **Safe to Replace:**
1. Backup current file: `mv general.md general.md.bak.<timestamp>`.
2. Replace with framework version: `mv general.md.framework-new general.md`.
3. No manual review needed.

**Priority:** Low  
**Action Required:** Automated replace (safe).

---

### 3. `directives/010_mode_protocol.md`

**Conflict Type:** Non-Breaking Addition

**Situation:**
- Framework version adds new primer integration section.
- Local version unchanged from previous framework release.
- New content can be appended without conflict.

**Diff Highlight:**

```diff
--- directives/010_mode_protocol.md (current)
+++ directives/010_mode_protocol.md.framework-new
@@ Line 85
+## Primer Integration
+
+When mode transitions occur, agents must invoke appropriate primers per ADR-011.
+
+[Details of primer invocation...]
```

**Analysis:**
- Framework adds new section at end of file.
- No modifications to existing content.
- Local version has no custom additions in this file.

**Recommendation:**

✅ **Adopt Framework Version:**
1. Accept new framework version with added primer integration section.
2. No manual intervention needed.
3. Review new section for awareness of primer requirements.

**Priority:** Low  
**Action Required:** Accept framework version.

---

### 4. `templates/architecture/ADR.md`

**Conflict Type:** Breaking Change

**Situation:**
- Framework version restructures ADR template with new required sections.
- Local version has custom fields added.
- Cannot auto-merge due to structural changes.

**Diff Highlight:**

```diff
--- templates/architecture/ADR.md (current)
+++ templates/architecture/ADR.md.framework-new
@@ Line 15
-## Decision
+## Decision Rationale
+
+### Context and Forces
+[New subsection]
+
+### Decision
```

**Analysis:**
- Framework renames section and adds subsections.
- Local version has custom metadata fields at top.
- Structural conflict requires manual resolution.

**Recommendation:**

⚠️ **Manual Review Required:**
1. Review `META/UPGRADE_NOTES_<version>.md` for ADR template changes.
2. Options:
   - **Option A:** Adopt new framework template structure. Existing ADRs remain valid; new ADRs use updated template.
   - **Option B:** Keep local template. Document decision to deviate from framework standard in `local/templates/README.md`.
3. If adopting new template:
   - Manually merge custom metadata fields into new structure.
   - Update ADR generation scripts if automated.
4. Consider impact on existing ADRs—backward compatibility is maintained (old ADRs not affected).

**Priority:** High  
**Action Required:** Decision + manual merge.

---

## Relocation Suggestions

### Files with Local Customizations

The following files have local customizations that may cause recurring conflicts in future upgrades. Consider relocating to `local/` directories to separate framework core from project-specific overrides:

| Current Path                                | Suggested Relocation Path                   | Notes                                           |
|---------------------------------------------|---------------------------------------------|-------------------------------------------------|
| `agents/architect.agent.md`         | `local/agents/architect-custom.agent.md`    | Custom directive descriptions                   |
| `directives/020_*.md`        | `local/directives/020_custom_leniency.md`   | Project-specific leniency rules                 |
| `templates/prompts/task.md`            | `local/templates/prompts/task-extended.md`  | Custom task metadata fields                     |

### Relocation Procedure

1. **Copy custom version to `local/` path:**
   ```bash
   cp agents/architect.agent.md local/agents/architect-custom.agent.md
   ```

2. **Adopt framework version in original location:**
   ```bash
   mv agents/architect.agent.md.framework-new agents/architect.agent.md
   ```

3. **Update references:**
   - If other files reference the custom version, update paths to point to `local/`.
   - Example: In `AGENTS.md`, add note: "See `local/agents/architect-custom.agent.md` for project-specific extensions."

4. **Document override:**
   - Create `local/README.md` explaining purpose of local overrides.
   - List all relocated files with rationale.

---

## New Files (No Conflict)

The following new framework files will be installed without conflict:

| Path                                      | Type               | Notes                                  |
|-------------------------------------------|--------------------|----------------------------------------|
| `agents/framework-guardian.agent.md` | New Agent Profile  | Introduced in framework version `X.Y.Z` |
| `directives/025_*.md`      | New Directive      | Framework Guardian workflow            |
| `templates/GUARDIAN_AUDIT_REPORT.md` | New Template       | Audit report format                    |

**Action:** These files will be created during upgrade. No manual intervention needed.

---

## Unchanged Files

The following files remain unchanged from source to target version:

- `agents/curator.agent.md`
- `directives/001_cli_shell_tooling.md`
- `templates/prompts/primer.md`
- *(X total unchanged files)*

**Action:** No action needed for these files.

---

## Upgrade Execution Checklist

### Pre-Upgrade

- [ ] **Backup current repository state:**
  ```bash
  git commit -am "Pre-upgrade checkpoint"
  git tag pre-upgrade-<old-version>
  ```

- [ ] **Resolve all ❗️ blocking issues** (see Critical Actions section).

- [ ] **Review ⚠️ high-priority warnings** and plan resolution.

### Upgrade Execution

- [ ] **For Auto-Merge Candidates:**
  - Create backups: `mv <file> <file>.bak.<timestamp>`
  - Replace with framework version: `mv <file>.framework-new <file>`

- [ ] **For Non-Breaking Additions:**
  - Review new content in `.framework-new`.
  - Adopt framework version if no local customizations.
  - Manually merge if local content present.

- [ ] **For Local Customizations:**
  - Choose: Keep current, manual merge, or relocate to `local/`.
  - Document decision in `local/README.md` or project notes.

- [ ] **For Breaking Changes:**
  - Review `META/UPGRADE_NOTES_<version>.md`.
  - Manually resolve structural conflicts.
  - Test affected functionality after merge.

### Post-Upgrade

- [ ] **Verify integrity:**
  ```bash
  # Run Framework Guardian audit
  # (or manually verify critical files)
  ```

- [ ] **Update `.framework_meta.yml`:**
  ```yaml
  framework_version: <new-version>
  upgraded_at: <timestamp>
  source_release: quickstart-framework-<new-version>.zip
  ```

- [ ] **Test framework functionality:**
  - Verify agent profiles load correctly.
  - Check directive references.
  - Validate templates render properly.

- [ ] **Commit upgrade:**
  ```bash
  git add .
  git commit -m "Upgrade framework from <old-version> to <new-version>"
  git tag framework-<new-version>
  ```

- [ ] **Document upgrade in project log:**
  - Add entry to CHANGELOG or work log.
  - Note any manual interventions performed.

---

## Rollback Plan

If upgrade fails or causes issues:

1. **Revert to pre-upgrade state:**
   ```bash
   git reset --hard pre-upgrade-<old-version>
   ```

2. **Restore `.framework_meta.yml`** if modified.

3. **Document rollback reason** in work log.

4. **Escalate to framework maintainers** if upgrade issues are framework-related.

---

## References

- **Upgrade Notes:** `META/UPGRADE_NOTES_<old>_to_<new>.md`
- **Release Notes:** `META/RELEASE_NOTES.md`
- **ADR-013:** Zip-Based Framework Distribution
- **ADR-014:** Framework Guardian Agent
- **Directive 025:** Framework Guardian procedures
- **Distribution Architecture:** `${DOC_ROOT}/architecture/design/distribution_of_releases_architecture.md`
- **Technical Design:** `${DOC_ROOT}/architecture/design/distribution_of_releases_technical_design.md`

---

## Support

For questions or issues during upgrade:

1. **Review upgrade notes:** `META/UPGRADE_NOTES_<old>_to_<new>.md`
2. **Consult distribution docs:** `${DOC_ROOT}/architecture/design/`
3. **Check ADR-014:** Framework Guardian decision rationale
4. **Escalate to framework maintainers:** Create issue in framework repository

---

**End of Upgrade Plan**
